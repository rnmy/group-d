function cov_1mwj1lih8d(){var path="/Users/tansuyin/Desktop/group-d/middleware/index.js";var hash="0b69a6d05fe099afbdd2808beb8afc493a4f0cd3";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/tansuyin/Desktop/group-d/middleware/index.js",statementMap:{"0":{start:{line:1,column:12},end:{line:1,column:38}},"1":{start:{line:2,column:12},end:{line:2,column:38}},"2":{start:{line:3,column:11},end:{line:3,column:36}},"3":{start:{line:4,column:14},end:{line:4,column:42}},"4":{start:{line:7,column:20},end:{line:7,column:22}},"5":{start:{line:9,column:0},end:{line:15,column:1}},"6":{start:{line:10,column:4},end:{line:12,column:5}},"7":{start:{line:11,column:8},end:{line:11,column:22}},"8":{start:{line:13,column:4},end:{line:13,column:61}},"9":{start:{line:14,column:4},end:{line:14,column:27}},"10":{start:{line:17,column:0},end:{line:36,column:1}},"11":{start:{line:18,column:4},end:{line:35,column:5}},"12":{start:{line:19,column:8},end:{line:31,column:10}},"13":{start:{line:20,column:12},end:{line:30,column:13}},"14":{start:{line:21,column:16},end:{line:21,column:54}},"15":{start:{line:22,column:16},end:{line:22,column:39}},"16":{start:{line:24,column:16},end:{line:29,column:17}},"17":{start:{line:25,column:20},end:{line:25,column:26}},"18":{start:{line:27,column:20},end:{line:27,column:79}},"19":{start:{line:28,column:20},end:{line:28,column:60}},"20":{start:{line:33,column:8},end:{line:33,column:65}},"21":{start:{line:34,column:8},end:{line:34,column:31}},"22":{start:{line:38,column:0},end:{line:57,column:1}},"23":{start:{line:39,column:4},end:{line:56,column:5}},"24":{start:{line:40,column:8},end:{line:52,column:10}},"25":{start:{line:41,column:12},end:{line:51,column:13}},"26":{start:{line:42,column:16},end:{line:42,column:54}},"27":{start:{line:43,column:16},end:{line:43,column:56}},"28":{start:{line:45,column:16},end:{line:50,column:17}},"29":{start:{line:46,column:20},end:{line:46,column:79}},"30":{start:{line:47,column:20},end:{line:47,column:94}},"31":{start:{line:49,column:20},end:{line:49,column:26}},"32":{start:{line:54,column:8},end:{line:54,column:65}},"33":{start:{line:55,column:8},end:{line:55,column:31}},"34":{start:{line:59,column:0},end:{line:78,column:1}},"35":{start:{line:60,column:4},end:{line:77,column:5}},"36":{start:{line:61,column:8},end:{line:73,column:10}},"37":{start:{line:62,column:12},end:{line:72,column:13}},"38":{start:{line:63,column:16},end:{line:63,column:54}},"39":{start:{line:64,column:16},end:{line:64,column:56}},"40":{start:{line:66,column:16},end:{line:71,column:17}},"41":{start:{line:67,column:20},end:{line:67,column:79}},"42":{start:{line:68,column:20},end:{line:68,column:94}},"43":{start:{line:70,column:20},end:{line:70,column:26}},"44":{start:{line:75,column:8},end:{line:75,column:65}},"45":{start:{line:76,column:8},end:{line:76,column:31}},"46":{start:{line:80,column:1},end:{line:96,column:2}},"47":{start:{line:81,column:5},end:{line:95,column:6}},"48":{start:{line:82,column:9},end:{line:94,column:11}},"49":{start:{line:83,column:13},end:{line:93,column:14}},"50":{start:{line:84,column:16},end:{line:84,column:56}},"51":{start:{line:85,column:16},end:{line:85,column:69}},"52":{start:{line:87,column:17},end:{line:92,column:18}},"53":{start:{line:88,column:21},end:{line:88,column:27}},"54":{start:{line:90,column:20},end:{line:90,column:79}},"55":{start:{line:91,column:20},end:{line:91,column:105}},"56":{start:{line:98,column:1},end:{line:114,column:2}},"57":{start:{line:99,column:5},end:{line:113,column:6}},"58":{start:{line:100,column:9},end:{line:112,column:11}},"59":{start:{line:101,column:13},end:{line:111,column:14}},"60":{start:{line:102,column:16},end:{line:102,column:53}},"61":{start:{line:103,column:16},end:{line:103,column:36}},"62":{start:{line:105,column:17},end:{line:110,column:18}},"63":{start:{line:106,column:21},end:{line:106,column:27}},"64":{start:{line:108,column:20},end:{line:108,column:79}},"65":{start:{line:109,column:20},end:{line:109,column:63}},"66":{start:{line:116,column:1},end:{line:129,column:2}},"67":{start:{line:117,column:5},end:{line:128,column:6}},"68":{start:{line:118,column:21},end:{line:118,column:70}},"69":{start:{line:119,column:8},end:{line:121,column:9}},"70":{start:{line:120,column:12},end:{line:120,column:25}},"71":{start:{line:122,column:8},end:{line:122,column:96}},"72":{start:{line:123,column:8},end:{line:123,column:28}},"73":{start:{line:125,column:9},end:{line:125,column:25}},"74":{start:{line:126,column:9},end:{line:126,column:63}},"75":{start:{line:127,column:9},end:{line:127,column:29}},"76":{start:{line:131,column:0},end:{line:131,column:31}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:27},end:{line:9,column:28}},loc:{start:{line:9,column:52},end:{line:15,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:17,column:31},end:{line:17,column:32}},loc:{start:{line:17,column:56},end:{line:36,column:1}},line:17},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:38},end:{line:19,column:39}},loc:{start:{line:19,column:59},end:{line:31,column:9}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:38,column:30},end:{line:38,column:31}},loc:{start:{line:38,column:55},end:{line:57,column:1}},line:38},"4":{name:"(anonymous_4)",decl:{start:{line:40,column:43},end:{line:40,column:44}},loc:{start:{line:40,column:64},end:{line:52,column:9}},line:40},"5":{name:"(anonymous_5)",decl:{start:{line:59,column:30},end:{line:59,column:31}},loc:{start:{line:59,column:55},end:{line:78,column:1}},line:59},"6":{name:"(anonymous_6)",decl:{start:{line:61,column:43},end:{line:61,column:44}},loc:{start:{line:61,column:64},end:{line:73,column:9}},line:61},"7":{name:"(anonymous_7)",decl:{start:{line:80,column:34},end:{line:80,column:35}},loc:{start:{line:80,column:59},end:{line:96,column:2}},line:80},"8":{name:"(anonymous_8)",decl:{start:{line:82,column:48},end:{line:82,column:49}},loc:{start:{line:82,column:71},end:{line:94,column:10}},line:82},"9":{name:"(anonymous_9)",decl:{start:{line:98,column:34},end:{line:98,column:35}},loc:{start:{line:98,column:59},end:{line:114,column:2}},line:98},"10":{name:"(anonymous_10)",decl:{start:{line:100,column:42},end:{line:100,column:43}},loc:{start:{line:100,column:62},end:{line:112,column:10}},line:100},"11":{name:"(anonymous_11)",decl:{start:{line:116,column:28},end:{line:116,column:29}},loc:{start:{line:116,column:59},end:{line:129,column:2}},line:116}},branchMap:{"0":{loc:{start:{line:10,column:4},end:{line:12,column:5}},type:"if",locations:[{start:{line:10,column:4},end:{line:12,column:5}},{start:{line:10,column:4},end:{line:12,column:5}}],line:10},"1":{loc:{start:{line:18,column:4},end:{line:35,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:35,column:5}},{start:{line:18,column:4},end:{line:35,column:5}}],line:18},"2":{loc:{start:{line:20,column:12},end:{line:30,column:13}},type:"if",locations:[{start:{line:20,column:12},end:{line:30,column:13}},{start:{line:20,column:12},end:{line:30,column:13}}],line:20},"3":{loc:{start:{line:24,column:16},end:{line:29,column:17}},type:"if",locations:[{start:{line:24,column:16},end:{line:29,column:17}},{start:{line:24,column:16},end:{line:29,column:17}}],line:24},"4":{loc:{start:{line:39,column:4},end:{line:56,column:5}},type:"if",locations:[{start:{line:39,column:4},end:{line:56,column:5}},{start:{line:39,column:4},end:{line:56,column:5}}],line:39},"5":{loc:{start:{line:41,column:12},end:{line:51,column:13}},type:"if",locations:[{start:{line:41,column:12},end:{line:51,column:13}},{start:{line:41,column:12},end:{line:51,column:13}}],line:41},"6":{loc:{start:{line:45,column:16},end:{line:50,column:17}},type:"if",locations:[{start:{line:45,column:16},end:{line:50,column:17}},{start:{line:45,column:16},end:{line:50,column:17}}],line:45},"7":{loc:{start:{line:60,column:4},end:{line:77,column:5}},type:"if",locations:[{start:{line:60,column:4},end:{line:77,column:5}},{start:{line:60,column:4},end:{line:77,column:5}}],line:60},"8":{loc:{start:{line:62,column:12},end:{line:72,column:13}},type:"if",locations:[{start:{line:62,column:12},end:{line:72,column:13}},{start:{line:62,column:12},end:{line:72,column:13}}],line:62},"9":{loc:{start:{line:66,column:16},end:{line:71,column:17}},type:"if",locations:[{start:{line:66,column:16},end:{line:71,column:17}},{start:{line:66,column:16},end:{line:71,column:17}}],line:66},"10":{loc:{start:{line:81,column:5},end:{line:95,column:6}},type:"if",locations:[{start:{line:81,column:5},end:{line:95,column:6}},{start:{line:81,column:5},end:{line:95,column:6}}],line:81},"11":{loc:{start:{line:83,column:13},end:{line:93,column:14}},type:"if",locations:[{start:{line:83,column:13},end:{line:93,column:14}},{start:{line:83,column:13},end:{line:93,column:14}}],line:83},"12":{loc:{start:{line:87,column:17},end:{line:92,column:18}},type:"if",locations:[{start:{line:87,column:17},end:{line:92,column:18}},{start:{line:87,column:17},end:{line:92,column:18}}],line:87},"13":{loc:{start:{line:99,column:5},end:{line:113,column:6}},type:"if",locations:[{start:{line:99,column:5},end:{line:113,column:6}},{start:{line:99,column:5},end:{line:113,column:6}}],line:99},"14":{loc:{start:{line:101,column:13},end:{line:111,column:14}},type:"if",locations:[{start:{line:101,column:13},end:{line:111,column:14}},{start:{line:101,column:13},end:{line:111,column:14}}],line:101},"15":{loc:{start:{line:105,column:17},end:{line:110,column:18}},type:"if",locations:[{start:{line:105,column:17},end:{line:110,column:18}},{start:{line:105,column:17},end:{line:110,column:18}}],line:105},"16":{loc:{start:{line:119,column:8},end:{line:121,column:9}},type:"if",locations:[{start:{line:119,column:8},end:{line:121,column:9}},{start:{line:119,column:8},end:{line:121,column:9}}],line:119}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"0b69a6d05fe099afbdd2808beb8afc493a4f0cd3"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1mwj1lih8d=function(){return actualCoverage;};}return actualCoverage;}cov_1mwj1lih8d();let Event=(cov_1mwj1lih8d().s[0]++,require("../models/event"));let Group=(cov_1mwj1lih8d().s[1]++,require("../models/group"));let User=(cov_1mwj1lih8d().s[2]++,require("../models/user"));let Message=(cov_1mwj1lih8d().s[3]++,require("../models/message"));// all the middleware goes here
let middlewareObj=(cov_1mwj1lih8d().s[4]++,{});cov_1mwj1lih8d().s[5]++;middlewareObj.isLoggedIn=function(req,res,next){cov_1mwj1lih8d().f[0]++;cov_1mwj1lih8d().s[6]++;if(req.isAuthenticated()){cov_1mwj1lih8d().b[0][0]++;cov_1mwj1lih8d().s[7]++;return next();}else{cov_1mwj1lih8d().b[0][1]++;}cov_1mwj1lih8d().s[8]++;req.flash("error","You need to be logged in to do that");cov_1mwj1lih8d().s[9]++;res.redirect("/login");};cov_1mwj1lih8d().s[10]++;middlewareObj.isEventCreator=function(req,res,next){cov_1mwj1lih8d().f[1]++;cov_1mwj1lih8d().s[11]++;if(req.isAuthenticated()){cov_1mwj1lih8d().b[1][0]++;cov_1mwj1lih8d().s[12]++;Event.findById(req.params.id,(err,foundEvent)=>{cov_1mwj1lih8d().f[2]++;cov_1mwj1lih8d().s[13]++;if(err){cov_1mwj1lih8d().b[2][0]++;cov_1mwj1lih8d().s[14]++;req.flash("error","Event not found!");cov_1mwj1lih8d().s[15]++;res.redirect("/events");}else{cov_1mwj1lih8d().b[2][1]++;cov_1mwj1lih8d().s[16]++;if(foundEvent.author.id.equals(req.user._id)){cov_1mwj1lih8d().b[3][0]++;cov_1mwj1lih8d().s[17]++;next();}else{cov_1mwj1lih8d().b[3][1]++;cov_1mwj1lih8d().s[18]++;req.flash("error","You don't have permission to do that!");cov_1mwj1lih8d().s[19]++;res.redirect("/events/"+req.params.id);}}});}else{cov_1mwj1lih8d().b[1][1]++;cov_1mwj1lih8d().s[20]++;req.flash("error","You need to be logged in to do that");cov_1mwj1lih8d().s[21]++;res.redirect("/login");}};cov_1mwj1lih8d().s[22]++;middlewareObj.isGroupMember=function(req,res,next){cov_1mwj1lih8d().f[3]++;cov_1mwj1lih8d().s[23]++;if(req.isAuthenticated()){cov_1mwj1lih8d().b[4][0]++;cov_1mwj1lih8d().s[24]++;Group.findById(req.params.groupid,(err,foundGroup)=>{cov_1mwj1lih8d().f[4]++;cov_1mwj1lih8d().s[25]++;if(err){cov_1mwj1lih8d().b[5][0]++;cov_1mwj1lih8d().s[26]++;req.flash("error","Group not found!");cov_1mwj1lih8d().s[27]++;res.redirect("/events/"+req.params.id);}else{cov_1mwj1lih8d().b[5][1]++;cov_1mwj1lih8d().s[28]++;if(!foundGroup.users.includes(req.user._id)){cov_1mwj1lih8d().b[6][0]++;cov_1mwj1lih8d().s[29]++;req.flash("error","You don't have permission to do that!");cov_1mwj1lih8d().s[30]++;res.redirect("/events/"+req.params.id+"/groups/"+req.params.groupid);}else{cov_1mwj1lih8d().b[6][1]++;cov_1mwj1lih8d().s[31]++;next();}}});}else{cov_1mwj1lih8d().b[4][1]++;cov_1mwj1lih8d().s[32]++;req.flash("error","You need to be logged in to do that");cov_1mwj1lih8d().s[33]++;res.redirect("/login");}};cov_1mwj1lih8d().s[34]++;middlewareObj.isGroupLeader=function(req,res,next){cov_1mwj1lih8d().f[5]++;cov_1mwj1lih8d().s[35]++;if(req.isAuthenticated()){cov_1mwj1lih8d().b[7][0]++;cov_1mwj1lih8d().s[36]++;Group.findById(req.params.groupid,(err,foundGroup)=>{cov_1mwj1lih8d().f[6]++;cov_1mwj1lih8d().s[37]++;if(err){cov_1mwj1lih8d().b[8][0]++;cov_1mwj1lih8d().s[38]++;req.flash("error","Group not found!");cov_1mwj1lih8d().s[39]++;res.redirect("/events/"+req.params.id);}else{cov_1mwj1lih8d().b[8][1]++;cov_1mwj1lih8d().s[40]++;if(!foundGroup.groupLeader.id.equals(req.user._id)){cov_1mwj1lih8d().b[9][0]++;cov_1mwj1lih8d().s[41]++;req.flash("error","You don't have permission to do that!");cov_1mwj1lih8d().s[42]++;res.redirect("/events/"+req.params.id+"/groups/"+req.params.groupid);}else{cov_1mwj1lih8d().b[9][1]++;cov_1mwj1lih8d().s[43]++;next();}}});}else{cov_1mwj1lih8d().b[7][1]++;cov_1mwj1lih8d().s[44]++;req.flash("error","You need to be logged in to do that");cov_1mwj1lih8d().s[45]++;res.redirect("/login");}};cov_1mwj1lih8d().s[46]++;middlewareObj.isMessageCreator=function(req,res,next){cov_1mwj1lih8d().f[7]++;cov_1mwj1lih8d().s[47]++;if(req.isAuthenticated()){cov_1mwj1lih8d().b[10][0]++;cov_1mwj1lih8d().s[48]++;Message.findById(req.params.messageid,(err,foundMessage)=>{cov_1mwj1lih8d().f[8]++;cov_1mwj1lih8d().s[49]++;if(err){cov_1mwj1lih8d().b[11][0]++;cov_1mwj1lih8d().s[50]++;req.flash("error","Message not found!");cov_1mwj1lih8d().s[51]++;res.redirect("/events/"+req.params.id+"/groups/");}else{cov_1mwj1lih8d().b[11][1]++;cov_1mwj1lih8d().s[52]++;if(foundMessage.author.id.equals(req.user._id)){cov_1mwj1lih8d().b[12][0]++;cov_1mwj1lih8d().s[53]++;next();}else{cov_1mwj1lih8d().b[12][1]++;cov_1mwj1lih8d().s[54]++;req.flash("error","You don't have permission to do that!");cov_1mwj1lih8d().s[55]++;res.redirect("/events/"+req.params.id+"/groups/"+req.params.groupid+"forum/");}}});}else{cov_1mwj1lih8d().b[10][1]++;}};cov_1mwj1lih8d().s[56]++;middlewareObj.isAuthorisedUser=function(req,res,next){cov_1mwj1lih8d().f[9]++;cov_1mwj1lih8d().s[57]++;if(req.isAuthenticated()){cov_1mwj1lih8d().b[13][0]++;cov_1mwj1lih8d().s[58]++;User.findById(req.params.userId,(err,foundUser)=>{cov_1mwj1lih8d().f[10]++;cov_1mwj1lih8d().s[59]++;if(err){cov_1mwj1lih8d().b[14][0]++;cov_1mwj1lih8d().s[60]++;req.flash("error","User not found!");cov_1mwj1lih8d().s[61]++;res.redirect("back");}else{cov_1mwj1lih8d().b[14][1]++;cov_1mwj1lih8d().s[62]++;if(foundUser._id.equals(req.user._id)){cov_1mwj1lih8d().b[15][0]++;cov_1mwj1lih8d().s[63]++;next();}else{cov_1mwj1lih8d().b[15][1]++;cov_1mwj1lih8d().s[64]++;req.flash("error","You don't have permission to do that!");cov_1mwj1lih8d().s[65]++;res.redirect("/users/"+req.params.userId);}}});}else{cov_1mwj1lih8d().b[13][1]++;}};cov_1mwj1lih8d().s[66]++;middlewareObj.isVerified=async function(req,res,next){cov_1mwj1lih8d().f[11]++;cov_1mwj1lih8d().s[67]++;try{const user=(cov_1mwj1lih8d().s[68]++,await User.findOne({username:req.body.username}));cov_1mwj1lih8d().s[69]++;if(user.isVerified){cov_1mwj1lih8d().b[16][0]++;cov_1mwj1lih8d().s[70]++;return next();}else{cov_1mwj1lih8d().b[16][1]++;}cov_1mwj1lih8d().s[71]++;req.flash("error","Please check your email and verify your account before logging in!");cov_1mwj1lih8d().s[72]++;res.redirect("back");}catch(err){cov_1mwj1lih8d().s[73]++;console.log(err);cov_1mwj1lih8d().s[74]++;req.flash("error","Something went wrong...Try again");cov_1mwj1lih8d().s[75]++;res.redirect("back");}};cov_1mwj1lih8d().s[76]++;module.exports=middlewareObj;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkV2ZW50IiwicmVxdWlyZSIsIkdyb3VwIiwiVXNlciIsIk1lc3NhZ2UiLCJtaWRkbGV3YXJlT2JqIiwiaXNMb2dnZWRJbiIsInJlcSIsInJlcyIsIm5leHQiLCJpc0F1dGhlbnRpY2F0ZWQiLCJmbGFzaCIsInJlZGlyZWN0IiwiaXNFdmVudENyZWF0b3IiLCJmaW5kQnlJZCIsInBhcmFtcyIsImlkIiwiZXJyIiwiZm91bmRFdmVudCIsImF1dGhvciIsImVxdWFscyIsInVzZXIiLCJfaWQiLCJpc0dyb3VwTWVtYmVyIiwiZ3JvdXBpZCIsImZvdW5kR3JvdXAiLCJ1c2VycyIsImluY2x1ZGVzIiwiaXNHcm91cExlYWRlciIsImdyb3VwTGVhZGVyIiwiaXNNZXNzYWdlQ3JlYXRvciIsIm1lc3NhZ2VpZCIsImZvdW5kTWVzc2FnZSIsImlzQXV0aG9yaXNlZFVzZXIiLCJ1c2VySWQiLCJmb3VuZFVzZXIiLCJpc1ZlcmlmaWVkIiwiZmluZE9uZSIsInVzZXJuYW1lIiwiYm9keSIsImNvbnNvbGUiLCJsb2ciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiNmtWQWVZOzJGQWZaLEdBQUlBLENBQUFBLEtBQUssMEJBQUdDLE9BQU8sQ0FBQyxpQkFBRCxDQUFWLENBQVQsQ0FDQSxHQUFJQyxDQUFBQSxLQUFLLDBCQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBVixDQUFULENBQ0EsR0FBSUUsQ0FBQUEsSUFBSSwwQkFBR0YsT0FBTyxDQUFDLGdCQUFELENBQVYsQ0FBUixDQUNBLEdBQUlHLENBQUFBLE9BQU8sMEJBQUdILE9BQU8sQ0FBQyxtQkFBRCxDQUFWLENBQVgsQ0FFQTtBQUNBLEdBQUlJLENBQUFBLGFBQWEsMEJBQUcsRUFBSCxDQUFqQixDLHdCQUVBQSxhQUFhLENBQUNDLFVBQWQsQ0FBMkIsU0FBU0MsR0FBVCxDQUFjQyxHQUFkLENBQW1CQyxJQUFuQixDQUF5QixpREFDaEQsR0FBR0YsR0FBRyxDQUFDRyxlQUFK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QUNJLEtBQUosQ0FBVSxPQUFWLENBQW1CLHVDQUFuQixFQURJLHlCQUVKSCxHQUFHLENBQUNJLFFBQUosQ0FBYSxVQUFZTCxHQUFHLENBQUNRLE1BQUosQ0FBV21CLE1BQXBDLEVBQ0YsQ0FDSixDQUNKLENBWkQsRUFhSCxDQWRELGtDQWVILENBaEJELEMseUJBa0JBN0IsYUFBYSxDQUFDK0IsVUFBZCxDQUEyQixlQUFlN0IsR0FBZixDQUFvQkMsR0FBcEIsQ0FBeUJDLElBQXpCLENBQStCLG1EQUN0RCxHQUFJLENBQ0QsS0FBTVksQ0FBQUEsSUFBSSwyQkFBRyxLQUFNbEIsQ0FBQUEsSUFBSSxDQUFDa0MsT0FBTCxDQUFhLENBQUNDLFFBQVEsQ0FBRS9CLEdBQUcsQ0FBQ2dDLElBQUosQ0FBU0QsUUFBcEIsQ0FBYixDQUFULENBQVYsQ0FEQyx5QkFFRCxHQUFJakIsSUFBSSxDQUFDZSxVQUFULENBQXFCLHNEQUNqQixNQUFPM0IsQ0FBQUEsSUFBSSxFQUFYLENBQ0gsQ0FGRCxrQ0FGQyx5QkFLREYsR0FBRyxDQUFDSSxLQUFKLENBQVUsT0FBVixDQUFtQixvRUFBbkIsRUFMQyx5QkFNREgsR0FBRyxDQUFDSSxRQUFKLENBQWEsTUFBYixFQUNGLENBQUMsTUFBT0ssR0FBUCxDQUFZLDBCQUNWdUIsT0FBTyxDQUFDQyxHQUFSLENBQVl4QixHQUFaLEVBRFUseUJBRVZWLEdBQUcsQ0FBQ0ksS0FBSixDQUFVLE9BQVYsQ0FBbUIsa0NBQW5CLEVBRlUseUJBR1ZILEdBQUcsQ0FBQ0ksUUFBSixDQUFhLE1BQWIsRUFDSCxDQUNKLENBYkQsQyx5QkFlRDhCLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQnRDLGFBQWpCIiwic291cmNlc0NvbnRlbnQiOlsibGV0IEV2ZW50ID0gcmVxdWlyZShcIi4uL21vZGVscy9ldmVudFwiKTtcbmxldCBHcm91cCA9IHJlcXVpcmUoXCIuLi9tb2RlbHMvZ3JvdXBcIik7XG5sZXQgVXNlciA9IHJlcXVpcmUoXCIuLi9tb2RlbHMvdXNlclwiKTtcbmxldCBNZXNzYWdlID0gcmVxdWlyZShcIi4uL21vZGVscy9tZXNzYWdlXCIpO1xuXG4vLyBhbGwgdGhlIG1pZGRsZXdhcmUgZ29lcyBoZXJlXG5sZXQgbWlkZGxld2FyZU9iaiA9IHt9O1xuXG5taWRkbGV3YXJlT2JqLmlzTG9nZ2VkSW4gPSBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICAgIGlmKHJlcS5pc0F1dGhlbnRpY2F0ZWQoKSl7XG4gICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgfVxuICAgIHJlcS5mbGFzaChcImVycm9yXCIsIFwiWW91IG5lZWQgdG8gYmUgbG9nZ2VkIGluIHRvIGRvIHRoYXRcIilcbiAgICByZXMucmVkaXJlY3QoXCIvbG9naW5cIik7XG59XG5cbm1pZGRsZXdhcmVPYmouaXNFdmVudENyZWF0b3IgPSBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkgeyBcbiAgICBpZihyZXEuaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAgICAgRXZlbnQuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCwgKGVyciwgZm91bmRFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJlcS5mbGFzaChcImVycm9yXCIsIFwiRXZlbnQgbm90IGZvdW5kIVwiKVxuICAgICAgICAgICAgICAgIHJlcy5yZWRpcmVjdChcIi9ldmVudHNcIilcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYoZm91bmRFdmVudC5hdXRob3IuaWQuZXF1YWxzKHJlcS51c2VyLl9pZCkpIHsgXG4gICAgICAgICAgICAgICAgICAgIG5leHQoKVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5mbGFzaChcImVycm9yXCIsIFwiWW91IGRvbid0IGhhdmUgcGVybWlzc2lvbiB0byBkbyB0aGF0IVwiKVxuICAgICAgICAgICAgICAgICAgICByZXMucmVkaXJlY3QoXCIvZXZlbnRzL1wiICsgcmVxLnBhcmFtcy5pZClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmVxLmZsYXNoKFwiZXJyb3JcIiwgXCJZb3UgbmVlZCB0byBiZSBsb2dnZWQgaW4gdG8gZG8gdGhhdFwiKVxuICAgICAgICByZXMucmVkaXJlY3QoXCIvbG9naW5cIik7XG4gICAgfVxufVxuXG5taWRkbGV3YXJlT2JqLmlzR3JvdXBNZW1iZXIgPSBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICAgIGlmKHJlcS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xuICAgICAgICBHcm91cC5maW5kQnlJZChyZXEucGFyYW1zLmdyb3VwaWQsIChlcnIsIGZvdW5kR3JvdXApID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXEuZmxhc2goXCJlcnJvclwiLCBcIkdyb3VwIG5vdCBmb3VuZCFcIilcbiAgICAgICAgICAgICAgICByZXMucmVkaXJlY3QoXCIvZXZlbnRzL1wiICsgcmVxLnBhcmFtcy5pZClcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoZm91bmRHcm91cC51c2Vycy5pbmNsdWRlcyhyZXEudXNlci5faWQpKSkge1xuICAgICAgICAgICAgICAgICAgICByZXEuZmxhc2goXCJlcnJvclwiLCBcIllvdSBkb24ndCBoYXZlIHBlcm1pc3Npb24gdG8gZG8gdGhhdCFcIilcbiAgICAgICAgICAgICAgICAgICAgcmVzLnJlZGlyZWN0KFwiL2V2ZW50cy9cIiArIHJlcS5wYXJhbXMuaWQgKyBcIi9ncm91cHMvXCIgKyByZXEucGFyYW1zLmdyb3VwaWQpXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbmV4dCgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcS5mbGFzaChcImVycm9yXCIsIFwiWW91IG5lZWQgdG8gYmUgbG9nZ2VkIGluIHRvIGRvIHRoYXRcIilcbiAgICAgICAgcmVzLnJlZGlyZWN0KFwiL2xvZ2luXCIpO1xuICAgIH1cbn1cblxubWlkZGxld2FyZU9iai5pc0dyb3VwTGVhZGVyID0gZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgICBpZihyZXEuaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAgICAgR3JvdXAuZmluZEJ5SWQocmVxLnBhcmFtcy5ncm91cGlkLCAoZXJyLCBmb3VuZEdyb3VwKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVxLmZsYXNoKFwiZXJyb3JcIiwgXCJHcm91cCBub3QgZm91bmQhXCIpXG4gICAgICAgICAgICAgICAgcmVzLnJlZGlyZWN0KFwiL2V2ZW50cy9cIiArIHJlcS5wYXJhbXMuaWQpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICghKGZvdW5kR3JvdXAuZ3JvdXBMZWFkZXIuaWQuZXF1YWxzKHJlcS51c2VyLl9pZCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5mbGFzaChcImVycm9yXCIsIFwiWW91IGRvbid0IGhhdmUgcGVybWlzc2lvbiB0byBkbyB0aGF0IVwiKVxuICAgICAgICAgICAgICAgICAgICByZXMucmVkaXJlY3QoXCIvZXZlbnRzL1wiICsgcmVxLnBhcmFtcy5pZCArIFwiL2dyb3Vwcy9cIiArIHJlcS5wYXJhbXMuZ3JvdXBpZClcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBuZXh0KClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmVxLmZsYXNoKFwiZXJyb3JcIiwgXCJZb3UgbmVlZCB0byBiZSBsb2dnZWQgaW4gdG8gZG8gdGhhdFwiKVxuICAgICAgICByZXMucmVkaXJlY3QoXCIvbG9naW5cIik7XG4gICAgfVxufVxuXG4gbWlkZGxld2FyZU9iai5pc01lc3NhZ2VDcmVhdG9yID0gZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgICAgaWYocmVxLmlzQXV0aGVudGljYXRlZCgpKSB7XG4gICAgICAgICBNZXNzYWdlLmZpbmRCeUlkKHJlcS5wYXJhbXMubWVzc2FnZWlkLCAoZXJyLCBmb3VuZE1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVxLmZsYXNoKFwiZXJyb3JcIiwgXCJNZXNzYWdlIG5vdCBmb3VuZCFcIilcbiAgICAgICAgICAgICAgICByZXMucmVkaXJlY3QoXCIvZXZlbnRzL1wiICsgcmVxLnBhcmFtcy5pZCArIFwiL2dyb3Vwcy9cIilcbiAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICBpZiAoZm91bmRNZXNzYWdlLmF1dGhvci5pZC5lcXVhbHMocmVxLnVzZXIuX2lkKSkge1xuICAgICAgICAgICAgICAgICAgICAgbmV4dCgpXG4gICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5mbGFzaChcImVycm9yXCIsIFwiWW91IGRvbid0IGhhdmUgcGVybWlzc2lvbiB0byBkbyB0aGF0IVwiKVxuICAgICAgICAgICAgICAgICAgICByZXMucmVkaXJlY3QoXCIvZXZlbnRzL1wiICsgcmVxLnBhcmFtcy5pZCArIFwiL2dyb3Vwcy9cIiArIHJlcS5wYXJhbXMuZ3JvdXBpZCArIFwiZm9ydW0vXCIpXG4gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICB9XG4gICAgICAgICB9KVxuICAgICB9XG4gfVxuXG4gbWlkZGxld2FyZU9iai5pc0F1dGhvcmlzZWRVc2VyID0gZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgICAgaWYgKHJlcS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xuICAgICAgICAgVXNlci5maW5kQnlJZChyZXEucGFyYW1zLnVzZXJJZCwgKGVyciwgZm91bmRVc2VyKSA9PiB7XG4gICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJlcS5mbGFzaChcImVycm9yXCIsIFwiVXNlciBub3QgZm91bmQhXCIpXG4gICAgICAgICAgICAgICAgcmVzLnJlZGlyZWN0KFwiYmFja1wiKVxuICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIuX2lkLmVxdWFscyhyZXEudXNlci5faWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICBuZXh0KClcbiAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVxLmZsYXNoKFwiZXJyb3JcIiwgXCJZb3UgZG9uJ3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGRvIHRoYXQhXCIpXG4gICAgICAgICAgICAgICAgICAgIHJlcy5yZWRpcmVjdChcIi91c2Vycy9cIiArIHJlcS5wYXJhbXMudXNlcklkKVxuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfVxuICAgICAgICAgfSlcbiAgICAgfVxuIH1cblxuIG1pZGRsZXdhcmVPYmouaXNWZXJpZmllZCA9IGFzeW5jIGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XG4gICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoe3VzZXJuYW1lOiByZXEuYm9keS51c2VybmFtZX0pXG4gICAgICAgIGlmICh1c2VyLmlzVmVyaWZpZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXh0KClcbiAgICAgICAgfVxuICAgICAgICByZXEuZmxhc2goXCJlcnJvclwiLCBcIlBsZWFzZSBjaGVjayB5b3VyIGVtYWlsIGFuZCB2ZXJpZnkgeW91ciBhY2NvdW50IGJlZm9yZSBsb2dnaW5nIGluIVwiKVxuICAgICAgICByZXMucmVkaXJlY3QoXCJiYWNrXCIpXG4gICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgcmVxLmZsYXNoKFwiZXJyb3JcIiwgXCJTb21ldGhpbmcgd2VudCB3cm9uZy4uLlRyeSBhZ2FpblwiKVxuICAgICAgICAgcmVzLnJlZGlyZWN0KFwiYmFja1wiKVxuICAgICB9XG4gfVxuXG5tb2R1bGUuZXhwb3J0cyA9IG1pZGRsZXdhcmVPYmo7Il19