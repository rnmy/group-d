<%- include("../partials/header") %>

<div class="container">
  <div class="jumbotron">
    <div class="container">
      <h1 class="mb-4 display-3">
        <%= event.name%>
        <div>
          <a class="btn btn-info ml-3" href="<%= event.url%>" target="_blank">
            See details
          </a>
          <% if (currentUser._id.equals(event.author.id)) { %>
            <a class="btn btn-success" href="/events/<%= event._id%>/edit">
              Edit this event
            </a>
          <% } else if (!(event.author.id == undefined) || (!event.author.username == undefined)) { %>
            <h6 class="ml-3 mt-2 text-secondary">Submitted by <a href="/users/<%=event.author.id%>"><%=event.author.username%></a></h6>
          <% } %>
        </div>
      </h1>
    </div>
  </div>

  <!-- Nav Bar -->
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link text-dark" href="/events/<%= event._id %>">Event Information</a>
    </li>
    <li class="nav-item">
      <a class="nav-link active" href="/events/<%= event._id %>/groups">Current Groups</a>
    </li>
  </ul>
</div>

<br>

<div class="container mb-5">
  <% if(event.groups.length == 0
      || (event.groups.filter((group) => group.isClosed).length 
      + event.groups.filter((group) => group.isDeleted).length === event.groups.length)) { %>
    <h4 class="mt-3">There are currently no groups for this event.</h4>
  <% } else { %>
    <% event.groups.forEach((group) => { %>
      <% if (!(group.isClosed) && (!(group.isDeleted))) { %>
        <div class="card mt-3" style="width: 18rem;">
          <div class="card-body">
            <h5 class="card-title"><%= group.name%></h5>
            <p class="card-text"><%= group.description%></p>
            <% if(group.users.length >= event.maxGroupSize){ %>
              <p class="card-text text-danger">This group is full</p>
            <% } else { %>
              <p class="card-text">Current group size: <%= group.users.length%></p>
            <% } %>
            <a href="/events/<%= event._id%>/groups/<%= group._id%>">See group details</a>
          </div>
        </div>
      <% } %>
    <% })%>
  <% } %>
  
  <% if (!(allUsers.includes(String(currentUser._id))) && !(allPending.includes(String(currentUser._id)))) { %>
    <a class="btn btn-primary mt-3" href="/events/<%= event._id%>/groups/new">Add a group</a>
  <% } %>
</div>

<%- include("../partials/footer") %>
